

SET FOREIGN_KEY_CHECKS = 0;

DROP TABLE IF EXISTS CONVALIDATIONS;
DROP TABLE IF EXISTS ADMINISTRATORS;
DROP TABLE IF EXISTS STUDENTS;
DROP TABLE IF EXISTS AUTH_STUDENTS;
DROP TABLE IF EXISTS SUBJECTS;
DROP TABLE IF EXISTS COURSES;
DROP TABLE IF EXISTS TYPES_COURSES;
DROP TABLE IF EXISTS GENERIC_COURSES;
DROP TABLE IF EXISTS WORKSHOPS;
DROP TABLE IF EXISTS DEPARTMENTS;
DROP TABLE IF EXISTS SPECIFIC_COURSES;

SET FOREIGN_KEY_CHECKS = 1;



CREATE TABLE ADMINISTRATORS (
    id INT AUTO_INCREMENT NOT NULL,
    first_name VARCHAR(255) NOT NULL,
    second_name VARCHAR(255) NOT NULL,
    first_last_name VARCHAR(255) NOT NULL,
    second_last_name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    PRIMARY KEY (id)
);

-- Tabla Alumnos
CREATE TABLE STUDENTS (
    id INT AUTO_INCREMENT NOT NULL,
    rol_student VARCHAR(10) UNIQUE NOT NULL,
    first_name VARCHAR(255) NOT NULL,
    second_name VARCHAR(255) NOT NULL,
    first_last_name VARCHAR(255) NOT NULL,
    second_last_name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    PRIMARY KEY (id)
);


CREATE TABLE TYPES_COURSES ( 
    id INT AUTO_INCREMENT NOT NULL, 
    name VARCHAR(255) NOT NULL UNIQUE, -- Asignatura INF, Asignatutra Externa, Curso Certificado, Taller de INF, Proyecto Personal
    PRIMARY KEY (id)
);

CREATE TABLE GENERIC_COURSES (
    id INT NOT NULL AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL UNIQUE,
    PRIMARY KEY (id)
);

CREATE TABLE WORKSHOPS (
    id INT AUTO_INCREMENT NOT NULL,
    name VARCHAR(255) NOT NULL UNIQUE,
    PRIMARY KEY (id)
);

CREATE TABLE DEPARTMENTS (
    id INT AUTO_INCREMENT NOT NULL,
    name VARCHAR(255) NOT NULL UNIQUE,
    PRIMARY KEY (id)
);


CREATE TABLE SPECIFIC_COURSES (
    id INT AUTO_INCREMENT NOT NULL,
    acronym VARCHAR(255) UNIQUE NOT NULL,	
    name VARCHAR(255) UNIQUE NOT NULL,
    id_department VARCHAR(255) NOT NULL,
    credits INT NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (id_department) REFERENCES DEPARTMENTS (id) 
);



CREATE TABLE CONVALIDATIONS (
    id INT NOT NULL AUTO_INCREMENT,
    id_student INT NOT NULL,
    convalidation_type INT NOT NULL, 
    id_generic_course INT NOT NULL,
    id_specific_course INT NOT NULL,
    state VARCHAR(50) NOT NULL DEFAULT 'Enviada',  -- Enviada, Rechazada, Aprobada por DI, En espera de DE, Aprobada por DE
    comments TEXT DEFAULT NULL,
    creation_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    revision_date TIMESTAMP,
    user_approves INT NOT NULL,
    file_data LONGBLOB DEFAULT NULL,
    file_name VARCHAR(255) DEFAULT NULL, 
    PRIMARY KEY (id),
    FOREIGN KEY (id_student) REFERENCES STUDENTS (id),
    FOREIGN KEY (convalidation_type) REFERENCES TYPES_COURSES (id)
    FOREIGN KEY (id_generic_course) REFERENCES GENERIC_COURSES (id),
    FOREIGN KEY (id_specific_course) REFERENCES SPECIFIC_COURSE (id),
    FOREIGN KEY (user_approves) REFERENCES ADMINISTRATORS (id)
    
);
